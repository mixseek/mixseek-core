# Contracts: GitHub Actions CI Pipeline

このディレクトリには、GitHub Actions CIパイプラインのインターフェース契約と期待される動作を定義したドキュメントが含まれています。

## Files

### workflow.yml

`.github/workflows/ci.yml` ワークフローファイルの期待される構造と動作を定義します。

**主な契約項目**:
- **トリガー契約**: developまたはmainブランチへのPR作成・更新時に実行
- **ジョブ契約**: 4つの独立したジョブ(ruff, mypy, pytest, docs)が並列実行
- **依存関係契約**: uvを使用した依存関係管理、`uv.lock`ベースのキャッシング
- **Pythonバージョン契約**: `.python-version`から動的に読み取り
- **ステータスチェック契約**: 4つすべてのチェックが成功するまでマージ禁止
- **パフォーマンス契約**: キャッシュ有効時5分以内、最大15分でタイムアウト
- **エラーハンドリング契約**: ジョブの独立性、タイムアウト動作、手動再実行

## Purpose

これらの契約は以下の目的で使用されます:

1. **実装ガイド**: 実装者が `.github/workflows/ci.yml` を作成する際の明確な仕様
2. **検証基準**: 実装後のCI動作が仕様を満たしているかの検証基準
3. **ドキュメント**: CIパイプラインの期待される動作を明文化し、チーム全体の理解を促進

## Validation

実装後、以下の方法で契約の遵守を検証します:

1. **トリガーテスト**: developまたはmainへPRを作成し、CIが自動実行されることを確認
2. **並列実行テスト**: 4つのジョブが並列実行され、個別のステータスチェックとして表示されることを確認
3. **失敗テスト**: 意図的にエラーを含むコードをコミットし、該当ジョブが失敗することを確認
4. **タイムアウトテスト**: (オプション) 長時間実行をシミュレートし、15分でタイムアウトすることを確認
5. **キャンセルテスト**: PR更新時に古いCIジョブが自動キャンセルされることを確認
6. **マージブロックテスト**: チェック失敗時にマージボタンが無効化されることを確認

詳細は `quickstart.md` の「実装後の検証手順」セクションを参照してください。
