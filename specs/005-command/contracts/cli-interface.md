# CLI Interface Contract: mixseek init

**Date**: 2025-10-16
**Command**: `mixseek init`
**Purpose**: このドキュメントは、CLIインターフェースの契約（入力、出力、終了コード）を定義します。

## Command Signature

```bash
mixseek init [OPTIONS]
```

## Options

| Option | Short | Type | Required | Default | Description |
|--------|-------|------|----------|---------|-------------|
| `--workspace` | `-w` | Path | No | `$MIXSEEK_WORKSPACE` | ワークスペースディレクトリのパス |
| `--help` | `-h` | Flag | No | N/A | ヘルプメッセージを表示 |

## Priority Logic

1. **CLI Option**: `--workspace` / `-w` が指定されている場合、そのパスを使用
2. **Environment Variable**: CLIオプションがない場合、`MIXSEEK_WORKSPACE` 環境変数を使用
3. **Error**: どちらも指定されていない場合、エラーを返す

## Input Validation

### Valid Inputs

1. **Absolute Path**:
   ```bash
   mixseek init --workspace /home/user/my-project
   ```

2. **Relative Path**:
   ```bash
   mixseek init --workspace ./workspace
   mixseek init --workspace ../project-workspace
   ```

3. **Path with Spaces**:
   ```bash
   mixseek init --workspace "/home/user/My Project"
   ```

4. **Symbolic Link**:
   ```bash
   mixseek init --workspace /path/to/symlink
   # System resolves symlink to actual directory
   ```

5. **Environment Variable**:
   ```bash
   export MIXSEEK_WORKSPACE=/home/user/workspace
   mixseek init
   ```

### Invalid Inputs

1. **No Path Specified**:
   ```bash
   mixseek init
   # Error: MIXSEEK_WORKSPACE not set and --workspace not provided
   ```

2. **Parent Directory Does Not Exist**:
   ```bash
   mixseek init --workspace /nonexistent/parent/workspace
   # Error: Parent directory does not exist
   ```

3. **No Write Permission**:
   ```bash
   mixseek init --workspace /root/workspace
   # Error: No write permission (unless running as root)
   ```

## Output Contract

### Success Output (stdout)

```
Workspace initialized successfully at: /absolute/path/to/workspace
Created directories: 3
Created files: 1
```

**Format**:
- Line 1: Success message with absolute workspace path
- Line 2: Number of created directories
- Line 3: Number of created files

### Error Output (stderr)

**Format**: `Error: {error_message}\nSolution: {solution_hint}`

**Examples**:

1. **Permission Error**:
   ```
   Error: No write permission: /root/workspace
   Solution: Check directory permissions or choose a different path.
   ```

2. **Parent Not Found**:
   ```
   Error: Parent directory does not exist: /nonexistent/parent
   Solution: Create the parent directory first or choose an existing location.
   ```

3. **Already Exists**:
   ```
   Error: Workspace already exists: /home/user/workspace
   Solution: Use a different path or remove the existing workspace.
   ```

4. **No Path Specified**:
   ```
   Error: Workspace path not specified.
   Solution: Use --workspace option or set MIXSEEK_WORKSPACE environment variable.
   ```

## Exit Codes

| Code | Meaning | When Used |
|------|---------|-----------|
| `0` | Success | Workspace created successfully |
| `1` | General Error | Any error during initialization (permission, path, I/O) |
| `2` | Invalid Usage | Missing required arguments or invalid option |

## Help Output

**Command**: `mixseek init --help`

**Expected Output** (stdout):
```
Usage: mixseek init [OPTIONS]

Initialize MixSeek workspace.

Creates workspace directory structure with:
- logs/      : Log files directory
- configs/   : Configuration files directory
- templates/ : Template files directory

Also generates a sample configuration file (config.toml) in configs/.

Options:
  -w, --workspace PATH  Workspace directory path
  -h, --help           Show this message and exit.

Examples:
  mixseek init --workspace /path/to/workspace
  mixseek init -w ./my-workspace
  export MIXSEEK_WORKSPACE=/path/to/workspace && mixseek init
```

## File System Effects

### Created Structure

```
{workspace}/
├── logs/                     # Empty directory
├── configs/
│   └── project.toml         # Sample configuration file
└── templates/                # Empty directory
```

### config.toml Content

```toml
# MixSeek Project Configuration
# Generated by: mixseek init

[project]
# Project name - edit this to match your project
name = "mixseek-project"

# Workspace directory path
workspace = "/absolute/path/to/workspace"

[logging]
# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
level = "INFO"

# Log message format
format = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
```

## Behavior Specifications

### Existing Workspace Handling

**Scenario**: User runs `mixseek init` on existing workspace

**Current Behavior** (FR-008):
```bash
mixseek init --workspace /existing/workspace
# Prompts: "Workspace already exists. Overwrite? [y/N]"
# If 'y': Recreates workspace
# If 'N': Aborts with exit code 1
```

**Note**: 具体的な確認プロンプトの実装は tasks.md で定義される

### Partial Workspace Handling

**Scenario**: Workspace exists but incomplete (e.g., only logs/ directory)

**Behavior** (A-002):
- Preserves existing directories
- Creates missing directories
- Does not delete existing files
- Generates config.toml if missing

### Platform-Specific Behavior

| Platform | Path Separator | Example |
|----------|----------------|---------|
| Linux/macOS | `/` | `/home/user/workspace` |
| Windows | `\` (auto-converted) | `C:\Users\user\workspace` |

**Note**: pathlib.Path handles platform differences automatically

## Test Scenarios

### Contract Tests

1. **Test Exit Code 0 on Success**
2. **Test Exit Code 1 on Error**
3. **Test stdout Format on Success**
4. **Test stderr Format on Error**
5. **Test Help Output Format**
6. **Test CLI Option Priority over Environment Variable**
7. **Test File System State After Success**

### Integration Tests

1. **Test Workspace Creation with Valid Path**
2. **Test Error on Invalid Parent Path**
3. **Test Error on Permission Denied**
4. **Test Symbolic Link Resolution**
5. **Test Path with Special Characters**
6. **Test Existing Workspace Handling**

## Compliance

- **Article 2 (CLI Interface Mandate)**: ✅ All requirements met
  - Text input: CLI options, environment variables
  - Text output: stdout for success, stderr for errors
  - JSON format: TOML (JSON-compatible)
  
- **Article 8 (Code Quality Standards)**: ✅ Type hints on all functions
  
- **Article 16 (Type Checking Imperative)**: ✅ mypy validation required

## Version

**Initial Version**: 1.0.0
**Date**: 2025-10-16
**Status**: Draft
