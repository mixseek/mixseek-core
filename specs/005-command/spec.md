# Feature Specification: mixseekコマンド初期化機能

**Feature Branch**: `004-mixseek-core-command`
**Created**: 2025-10-16
**Status**: Draft
**Input**: User description: "ブランチ名: 004-mixseek-core-command, specs/005-command/assets/mixseek-command-summary.md 内容で、日本語で要件と仕様を考えてください"

## Clarifications

### Session 2025-10-16

- Q: プロジェクト名の取得方法 - サンプルTOML設定ファイルに含めるプロジェクト名をシステムがどのように取得すべきか？ → A: デフォルトのプレースホルダー値（例: "my-mixseek-project"）を使用し、ユーザーが手動で編集する
- Q: ユーザーの呼称 - 仕様書でコマンドを使用する人をどのように呼ぶべきか？「開発者として」とあるが、実際にはエンドユーザーも使用する → A: "MixSeekを使用する人として"
- Q: 設定ファイルの具体的な内容 - テンプレート設定ファイルにどの設定を含めるべきか？ → A: すぐに使用可能なオーケストレーター設定（シンプル版と多視点版）、チーム設定（汎用、SNS、学術）、評価設定（4メトリクス）、判定設定
- Q: 設定ファイルのファイル名 - 生成される設定ファイルのファイル名は何にするべきか？ → A: search_news.toml、search_news_multi_perspective.toml、team_*.toml、evaluator_search_news.toml、judgment_search_news.toml
- Q: パフォーマンス基準のハードウェア仕様 - SC-006の「標準的なハードウェア環境において」という表現をどう扱うか？ → A: 具体的な数値目標のみを保持し、ハードウェア仕様は言及しない
- Q: --forceオプションの動作 - 既存ワークスペースに対して--forceオプションが指定された場合の動作は？ → A: 既存ファイルをすべて削除して完全に再初期化する

## User Scenarios & Testing *(mandatory)*

### User Story 1 - ワークスペースの初期化 (Priority: P1)

MixSeekを使用する人として、MixSeekプロジェクトを新しく開始する際に、必要なディレクトリ構造と設定ファイルを自動的に作成したい。これにより、手動でディレクトリを作成したり、設定ファイルのテンプレートを探したりする手間を省き、すぐにプロジェクトの開発を始められる。

**Why this priority**: これはMixSeekフレームワークを使用する際の最初のステップであり、すべてのプロジェクトで必須となる基盤機能である。この機能がなければ、ユーザーは手動でディレクトリ構造を作成し、設定ファイルを準備する必要があり、開発開始までの時間が大幅に増加する。

**Independent Test**: `mixseek init`コマンドを実行し、指定されたワークスペースディレクトリに必要なサブディレクトリ（logs、configs、templates）が作成され、設定ファイルのサンプルが生成されることを確認することで、独立してテスト可能である。

**Acceptance Scenarios**:

1. **Given** MixSeekがインストールされており、環境変数`MIXSEEK_WORKSPACE`が設定されている、**When** ユーザーが`mixseek init`コマンドを実行する、**Then** 環境変数で指定されたディレクトリにワークスペースが作成され、サブディレクトリ（logs、configs、templates）が生成され、設定ファイルのサンプルがconfigsディレクトリに配置される

2. **Given** MixSeekがインストールされており、環境変数`MIXSEEK_WORKSPACE`が設定されていない、**When** ユーザーが`mixseek init --workspace /path/to/workspace`コマンドを実行する、**Then** 指定されたパスにワークスペースが作成され、サブディレクトリ（logs、configs、templates）が生成され、設定ファイルのサンプルがconfigsディレクトリに配置される

3. **Given** ワークスペースディレクトリがすでに存在している、**When** ユーザーが`mixseek init`コマンドを実行する、**Then** システムは既存のワークスペースを検出し、ユーザーに警告を表示し、上書きするか確認を求める

4. **Given** 指定されたワークスペースパスの親ディレクトリが存在しない、**When** ユーザーが`mixseek init`コマンドを実行する、**Then** システムはエラーメッセージを表示し、親ディレクトリが存在しないことを通知する

5. **Given** ユーザーが書き込み権限のないディレクトリを指定している、**When** ユーザーが`mixseek init`コマンドを実行する、**Then** システムは権限エラーを表示し、適切な権限を持つディレクトリを指定するよう促す

---

### User Story 2 - コマンドヘルプとバージョン情報の表示 (Priority: P2)

MixSeekを使用する人として、`mixseek`コマンドの使い方やオプションを確認したい。また、インストールされているMixSeekのバージョンを知りたい。これにより、正しいコマンド構文を使用でき、バージョン固有の機能や問題を把握できる。

**Why this priority**: ヘルプ情報はユーザー体験の重要な要素であり、ユーザーがコマンドを効果的に使用するために必要である。ただし、ワークスペースの作成自体よりは優先度が低い。

**Independent Test**: `mixseek --help`および`mixseek --version`コマンドを実行し、適切なヘルプメッセージとバージョン情報が表示されることを確認することで、独立してテスト可能である。

**Acceptance Scenarios**:

1. **Given** MixSeekがインストールされている、**When** ユーザーが`mixseek --help`コマンドを実行する、**Then** 利用可能なサブコマンド（init、execute、config）の一覧と各コマンドの簡潔な説明が表示される

2. **Given** MixSeekがインストールされている、**When** ユーザーが`mixseek init --help`コマンドを実行する、**Then** initコマンドの詳細な使用方法、利用可能なオプション（--workspace、-w）、および使用例が表示される

3. **Given** MixSeekがインストールされている、**When** ユーザーが`mixseek --version`コマンドを実行する、**Then** インストールされているMixSeekのバージョン番号が表示される

---

### User Story 3 - ワークスペースパスの省略形サポート (Priority: P3)

MixSeekを使用する人として、ワークスペースパスを指定する際に、短いオプション（`-w`）を使用したい。これにより、コマンドの入力が簡潔になり、繰り返しコマンドを実行する際の手間が減る。

**Why this priority**: これは利便性の向上であり、機能的には`--workspace`オプションと同等である。ユーザー体験を向上させるが、必須機能ではない。

**Independent Test**: `mixseek init -w /path/to/workspace`コマンドを実行し、`--workspace`オプションと同じ結果が得られることを確認することで、独立してテスト可能である。

**Acceptance Scenarios**:

1. **Given** MixSeekがインストールされている、**When** ユーザーが`mixseek init -w /path/to/workspace`コマンドを実行する、**Then** `mixseek init --workspace /path/to/workspace`と同じ動作をし、指定されたパスにワークスペースが作成される

---

### Edge Cases

- ワークスペースディレクトリがすでに存在し、部分的にファイルが配置されている場合、システムはどのように対処するか？（既存ファイルを保持しつつ、不足しているディレクトリやファイルのみを追加する）

- ワークスペースパスに特殊文字（スペース、マルチバイト文字など）が含まれている場合、システムは正しく処理できるか？（パスを適切にエスケープし、クロスプラットフォームで動作する）

- 環境変数`MIXSEEK_WORKSPACE`と`--workspace`オプションの両方が指定されている場合、どちらが優先されるか？（`--workspace`オプションが優先される）

- ユーザーがシンボリックリンクをワークスペースパスとして指定した場合、システムはどのように動作するか？（シンボリックリンクを解決し、実際のディレクトリパスを使用する）

- ディスク容量が不足している場合、システムはどのようにエラーを報告するか？（明確なエラーメッセージを表示し、必要なディスク容量を通知する）

- 設定ファイルのサンプル生成中にエラーが発生した場合、システムはどのように回復するか？（作成済みのディレクトリを保持し、エラー詳細を表示してユーザーに再試行を促す）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは`mixseek init`コマンドを提供しなければならない。このコマンドは、MixSeekプロジェクトのワークスペースを初期化する機能を持つ

- **FR-002**: システムは環境変数`MIXSEEK_WORKSPACE`からワークスペースディレクトリのパスを読み取り、そのディレクトリを作成しなければならない

- **FR-003**: システムは`--workspace`（または短縮形`-w`）オプションを受け付け、環境変数が設定されていない場合でもワークスペースパスを指定できるようにしなければならない

- **FR-003.1**: システムは`--force`（または短縮形`-f`）オプションを受け付け、既存ワークスペースを確認なしで完全に再初期化できるようにしなければならない

- **FR-004**: `--workspace`オプションが指定されている場合、環境変数`MIXSEEK_WORKSPACE`よりも優先しなければならない

- **FR-005**: システムは指定されたワークスペースディレクトリ内に、以下のサブディレクトリを作成しなければならない:
  - `logs`: ログファイルを保存するディレクトリ
  - `configs`: 設定ファイルを保存するディレクトリ
  - `templates`: テンプレートファイルを保存するディレクトリ

- **FR-006**: システムは`configs`ディレクトリ内に、すぐに使用可能なオーケストレーター設定、チーム設定、評価設定、判定設定のテンプレートファイル（TOML形式）を生成しなければならない

- **FR-007**: テンプレート設定ファイルには以下が含まれていなければならない：
  - オーケストレーター設定（シンプル版と多視点版）
  - チーム設定（汎用、SNS、学術の3種類）
  - 評価設定（Coverage, Relevance, ClarityCoherence, Noveltyの4メトリクス）
  - 判定設定（ラウンド継続判定）

- **FR-016**: ワークスペースディレクトリがすでに存在する場合、システムはユーザーに警告を表示し、上書きするか確認を求めなければならない。`--force`オプションが指定されている場合は、確認なしで既存ファイルをすべて削除して完全に再初期化する

- **FR-017**: 指定されたワークスペースパスの親ディレクトリが存在しない場合、システムはエラーメッセージを表示し、初期化を中断しなければならない

- **FR-018**: ユーザーが指定したディレクトリに書き込み権限がない場合、システムは権限エラーを表示し、適切な権限を持つディレクトリを指定するよう促さなければならない

- **FR-019**: システムは`--help`オプションを提供し、`mixseek init`コマンドの使用方法、利用可能なオプション、および使用例を表示しなければならない

- **FR-020**: システムは`--version`オプションを提供し、インストールされているMixSeekのバージョン番号を表示しなければならない

- **FR-021**: コマンドの実行中にエラーが発生した場合、システムは明確なエラーメッセージを標準エラー出力（stderr）に表示しなければならない

- **FR-022**: コマンドが正常に完了した場合、システムは成功メッセージとワークスペースのパスを標準出力（stdout）に表示しなければならない

- **FR-023**: システムはクロスプラットフォーム（Linux、macOS、Windows）で動作しなければならない

### Key Entities

- **ワークスペース**: MixSeekプロジェクトの作業領域を表すディレクトリ。logs、configs、templatesの3つのサブディレクトリと、すぐに使用可能なテンプレート設定ファイルを含む

- **設定ファイル**: TOML形式のファイルで、オーケストレーター、チーム、評価、判定の動作を制御する設定項目を格納する。インストール後5分以内に利用開始できる実用的な設定が含まれる

- **コマンドオプション**: `--workspace`/`-w`オプションで、ワークスペースディレクトリのパスを指定する。環境変数よりも優先される

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: MixSeekを使用する人は`mixseek init`コマンドを実行してから30秒以内にワークスペースの初期化を完了できる

- **SC-002**: 初期化されたワークスペースには、必要なすべてのディレクトリ（logs、configs、templates）と設定ファイルのサンプルが含まれている

- **SC-003**: ユーザーの95%以上が、ヘルプメッセージを参照することで、初回使用時に正しくコマンドを実行できる

- **SC-004**: エラーが発生した場合、ユーザーの90%以上がエラーメッセージを理解し、適切な対処（親ディレクトリの作成、権限の変更など）を実行できる

- **SC-005**: コマンドはLinux、macOS、Windowsのすべてのプラットフォームで一貫した動作をする

- **SC-006**: コマンドの実行からワークスペース作成完了までの時間が5秒以内である

## Assumptions *(include if making informed guesses)*

- **A-001**: サンプル設定ファイルには、一般的なMixSeekプロジェクトで使用される基本的な設定項目（プロジェクト名、ワークスペースパス、ログレベル、ログ出力先）が含まれる。プロジェクト名フィールドにはデフォルトのプレースホルダー値 "mixseek-project" が設定される

- **A-002**: ワークスペースディレクトリがすでに存在し、サブディレクトリが部分的に配置されている場合、システムは既存のディレクトリを保持し、不足しているディレクトリのみを追加する

- **A-003**: 環境変数`MIXSEEK_WORKSPACE`と`--workspace`オプションの両方が指定されている場合、`--workspace`オプションが優先される

- **A-004**: シンボリックリンクがワークスペースパスとして指定された場合、システムはシンボリックリンクを解決し、実際のディレクトリパスを使用する

- **A-005**: 設定ファイルのサンプルは、コメント付きで各設定項目の説明が含まれ、ユーザーが編集しやすい形式で提供される

- **A-006**: `mixseek execute`および`mixseek config`コマンドは将来の実装対象であり、このフェーズでは実装範囲外とする

## Dependencies *(include if applicable)*

- **D-001**: この機能は、specs/001-specsで定義されているMixSeek-Coreフレームワークの一部として実装される

- **D-002**: ワークスペース構造の詳細は、specs/002-config（将来作成予定）で定義される設定管理仕様に依存する可能性がある
